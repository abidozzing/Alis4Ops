@using Alis4Ops2024.Web.Core
@using Alis4Ops2024.Web.Models
@inject NavigationManager _navigationManager
@inject IJSRuntime JSRuntime
@using System
<link href="css/site.css" rel="stylesheet" />



<PageTitle>DivideMathQuiz</PageTitle>

<title>Your Page Title</title>


@if (Question.InputPosition <= 0 || Question.InputPosition > 3)
{
    Question.InputPosition = 3;
}
@switch (Question.InputPosition)
{
    case 1:

        <div class="row  gx-0">
            <!-- Message Good Job! or Please try again. -->
            <div class="col-12 p-1 d-flex text-dark justify-content-center align-items-center" style="height: 30px; box-sizing: border-box;">
                <div style="color: @resultColor;">@resultMessage</div>
            </div>
        </div>

        <!-- Divide Operand1 Vertical ? -->
@*         <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div> *@

        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid white; border-top: 4px solid white; background-color: yellow; font-size: 75%; width: 12.5%; padding-left: 10px">
                    @Question.Operand1
                </div>
            </div>
        </div>
        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box" style="border-left: 4px solid white; border-top: 4px solid white; background-color: lightskyblue; font-size: 75%; width: 8%; padding-right: 6px; margin-bottom: 20px; text-align: right; padding-right: 6px;">
                    @Question.Operand2
                </div>
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid black; border-top: 4px solid black; background-color: lightgreen; font-size: 75%; width: 12.5%; padding-left: 10px; margin-bottom: 20px;">
                    @displayedValue
                </div>
            </div>
        </div>


        <!-- Divide Operator Symbol and Operand2 Vertical -->
        //@Question.OperatorAsSymbol @Question.Operand2
                    //@displayedValue
@*         <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div> *@


        <div class="row gx-0" style="padding:0px;">
            <!-- InputBox userInput -->
            <div class="col-3 d-flex text-dark">
                <input class="input-box" id="AnswerNumber" pattern="[0-9]*" type="number" placeholder="?" style="background-color: lightgreen;  color: mediumblue; font-weight: bold; text-align: center; align-content: center; border: 0;" @bind-value="userInput" @oninput="HandleInput" @onkeydown="HandleKeydown" @ref="inputElement" />
            </div>

            <!-- Switch case for Operator -->
            <div class="col p-1 bg-light d-flex justify-content-center align-items-center text-dark">
                @switch (Question.Operator)
                {
                    case "Add":
                        <i class="fa-solid fa-add"></i>
                        break;
                    case "Subtract":
                        <i class="fa-solid fa-minus"></i>
                        break;
                    case "Multiply":
                        <i class="fa-solid fa-times"></i>
                        break;
                    case "Divide":
                        <i class="fa-solid fa-divide"></i>
                        break;
                    default:
                        <strong>@Question.OperatorAsSymbol</strong>
                        break;
                }
            </div>

            <!-- Operand2 -->
            <div class="col-3 p-1 d-flex justify-content-center align-items-center text-dark" style="background-color: lightskyblue; text-align: center;">
                <strong>@Question.Operand2</strong>
            </div>

            <div class="col p-1 d-flex justify-content-center align-items-center text-dark" style="text-align: center;">
                <strong><i class="fa-solid fa-equals"></i></strong>
            </div>

            <!-- Operand1 -->
            <div class="col-3 p-1 d-flex justify-content-end align-items-center text-dark" style="background-color: yellow; ">
                <strong>@Question.Operand1</strong>
            </div>
        </div>

        break;

    case 2:

        <div class="row  gx-0">
            <!-- Message Good Job! or Please try again. -->
            <div class="col-12 p-1 d-flex text-dark justify-content-center align-items-center" style="height: 30px; box-sizing: border-box;">
                <div style="color: @resultColor;">@resultMessage</div>
            </div>
        </div>

        <!-- Divide Operand1 Vertical -->
                    // @Question.Operand1 @displayedValue
        //
@*         <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div>
 *@

        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid white; border-top: 4px solid white; background-color: lightskyblue; font-size: 75%; width: 12.5%; padding-left: 10px">
                    @Question.Operand2
                </div>
            </div>
        </div>
        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box" style="border-left: 4px solid white; border-top: 4px solid white; background-color: lightgreen; font-size: 75%; width: 6%; padding-right: 8px; margin-bottom: 20px; text-align: right; padding-right: 6px;">
                    @displayedValue
                </div>
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid black; border-top: 4px solid black; background-color: yellow; font-size: 75%; width: 12.5%; padding-left: 10px; margin-bottom: 20px;">
                    @Question.Operand1
                </div>
            </div>
        </div>

        <!-- Divide Operator Symbol and Operand2 Vertical @Question.OperatorAsSymbol ? -->
@*         <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div> *@

        <div class="row gx-0" style="padding:0px;">
            <!-- Operand1 -->
            <div class="col-3 p-1 d-flex justify-content-center align-items-center text-dark" style="background-color: yellow; ">
                <strong>@Question.Operand1</strong>
            </div>

            <!-- Switch case for Operator -->
            <div class="col p-1 bg-light d-flex justify-content-center align-items-center text-dark">
                @switch (Question.Operator)
                {
                    case "Add":
                        <i class="fa-solid fa-add"></i>
                        break;
                    case "Subtract":
                        <i class="fa-solid fa-minus"></i>
                        break;
                    case "Multiply":
                        <i class="fa-solid fa-times"></i>
                        break;
                    case "Divide":
                        <i class="fa-solid fa-divide"></i>
                        break;
                    default:
                        <strong>@Question.OperatorAsSymbol</strong>
                        break;
                }
            </div>

            <!-- InputBox userInput -->
            <div class="col-3 d-flex text-dark">
                <input class="input-box" id="AnswerNumber" pattern="[0-9]*" type="number" placeholder="?" style="background-color: lightgreen; color:mediumblue; font-weight: bold; text-align: center; align-content: center;  border: 0" @bind-value="userInput" @oninput="HandleInput" @onkeydown="HandleKeydown" @ref="inputElement" />
            </div>

            <div class="col p-1 d-flex justify-content-center align-items-center text-dark" style="text-align: center;">
                <strong><i class="fa-solid fa-equals"></i></strong>
            </div>

            <!-- Operand2 -->
            <div class="col-3 p-1 d-flex justify-content-end align-items-end text-dark" style="background-color: lightskyblue; text-align: center;">
                <strong>@Question.Operand2</strong>
            </div>
        </div>
        break;

    case 3:

        <div class="row  gx-0">
            <!-- Message Good Job! or Please try again. -->
            <div class="col-12 p-1 d-flex text-dark justify-content-center align-items-center" style="height: 30px; box-sizing: border-box;">
                <div style="color: @resultColor;">@resultMessage</div>
            </div>
        </div>

@*         <!-- Divide Operand1 Vertical @Question.Operand1 -->
        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div> *@

        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid white; border-top: 4px solid white; background-color: lightgreen; font-size: 75%; width: 12.5%; padding-left: 10px;">
                    @displayedValue
                </div>
            </div>
        </div>
        <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box;  color:black;">
                <div class="box" style="border-left: 4px solid white; border-top: 4px solid white; background-color: lightskyblue; font-size: 75%; width: 8%; margin-bottom: 20px; text-align: right; padding-right: 6px;">
                    @Question.Operand2
                </div>
                <div class="box d-flex justify-content-right align-items-right" style="border-left: 4px solid black; border-top: 4px solid black; background-color: yellow; font-size: 75%; width: 12.5%; padding-left: 10px; margin-bottom: 20px;">
                    @Question.Operand1
                </div>
            </div>
        </div>


        <!-- Divide Operator Symbol and Operand2 Vertical @Question.OperatorAsSymbol @Question.Operand2 -->
        @*         <div class="row gx-0" style="padding:0px;">
            <div class="col-12 d-flex" style=" justify-content: flex-end; box-sizing: border-box; color:white;">.</div>
        </div> *@

        <div class="row gx-0" style="padding:0px;">
            <!-- Operand1 -->
            <div class="col-3 p-1 d-flex justify-content-center align-items-center text-dark" style="background-color: yellow; ">
                <strong>@Question.Operand1</strong>
            </div>

            <!-- Switch case for Operator -->
            <div class="col p-1 bg-light d-flex justify-content-center align-items-center text-dark">
                @switch (Question.Operator)
                {
                    case "Add":
                        <i class="fa-solid fa-add"></i>
                        break;
                    case "Subtract":
                        <i class="fa-solid fa-minus"></i>
                        break;
                    case "Multiply":
                        <i class="fa-solid fa-times"></i>
                        break;
                    case "Divide":
                        <i class="fa-solid fa-divide"></i>
                        break;
                    default:
                        <strong>@Question.OperatorAsSymbol</strong>
                        break;
                }
            </div>

            <!-- Operand2 -->
            <div class="col-3 p-1 d-flex justify-content-center align-items-center text-dark" style="background-color: lightskyblue; text-align: center;">
                <strong>@Question.Operand2</strong>
            </div>

            <div class="col p-1 d-flex justify-content-center align-items-center text-dark" style="text-align: center;">
                <strong><i class="fa-solid fa-equals"></i></strong>
            </div>

            <!-- InputBox userInput -->
            <div class="col-3 d-flex text-dark">
                <input class="input-box" id="AnswerNumber" pattern="[0-9]*" type="number" placeholder="?" style="background-color: lightgreen; color:mediumblue; font-weight: bold; text-align: right; border: 0;  border: 2px solid green;" @bind-value="userInput" @oninput="HandleInput" @onkeydown="HandleKeydown" @ref="inputElement" />
            </div>
        </div>

        break;
}

<style>
    /* Remove spinner buttons for number inputs in WebKit browsers */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
</style>


@code {
    private string displayedValue = "?"; // Displayed value synced with user input

    private async Task HandleInput(ChangeEventArgs args)
    {
        userInput = args.Value?.ToString(); // Update userInput from event args
        displayedValue = userInput; // Sync displayed value with userInput

        await InvokeAsync(() => StateHasChanged()); // Refresh UI after input change
    }
    [Parameter] public BaseQuestion Question { get; set; }
    [Parameter] public EventCallback AnsweredCorrectly { get; set; }
    [Parameter] public EventCallback AnsweredWrongly { get; set; }
    [Parameter] public int Answer { get; set; }
    private ElementReference inputElement;

    // protected override void OnInitialized()
    // {
    //     base.OnInitialized();

    //     // Initialize the Question property here
    //     Question = new BaseQuestion();
    //     //Question.Operator = "Add";
    // }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // if (firstRender)
        // {
        inputElement.FocusAsync();
        // }
    }
    // The key to binding is:
    // 1. @bind-value="userInput"
    // This means bind the value of the property called value

    // 2. @bind-value:event="oninput"
    // This means bind the

    //@bind-{HTMLElementPropertyName}="{variable}"
    private string? userInput = "";
    private bool showResult;
    private string resultMessage = "";
    private string resultColor = "White";
    private DateTimeCounterStopWatch dateTimeCounterStopWatch; // Reference to child component
    // [Inject]
    // private IQuestionGeneratorService QuestionGenerator { get; set; }

    private async Task HandleKeydown(KeyboardEventArgs args)
    {
        if (args.Key == "Enter")
        {
            // Retrieve current input value
            userInput = userInput.Trim(); // Trim any leading or trailing whitespace
            int parsedInput;

            // Check if userInput is numeric
            if (!int.TryParse(userInput, out parsedInput))
            {
                // If userInput is not numeric, select the input text and return
                await JSRuntime.InvokeVoidAsync("eval", "document.activeElement.select();");
                return;
            }

            // Now we know userInput is numeric, proceed with the comparison
            if (parsedInput == Question.Answer)
            {
                resultMessage = "Good Job!";
                resultColor = "green";
                await Task.Delay(500);
                userInput = ""; // Clear input after correct answer
                resultMessage = "";
                resultColor = "white"; // Reset color
                displayedValue = "?";
                // dateTimeCounterStopWatch.ResetAndStartStopwatch();
                // await dateTimeCounterStopWatch.IncrementCounter();
                await AnsweredCorrectly.InvokeAsync();
                ;
            }
            else
            {
                resultMessage = "Please Try Again.";
                resultColor = "red";
                await JSRuntime.InvokeVoidAsync("eval", "document.activeElement.select()");
                // await dateTimeCounterStopWatch.IncrementErrorCount();
                await AnsweredWrongly.InvokeAsync();
                ;
            }

            showResult = true;
            await InvokeAsync(() => StateHasChanged());
        }
    }
}

