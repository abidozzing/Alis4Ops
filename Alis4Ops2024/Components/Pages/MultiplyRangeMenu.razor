@inherits LayoutComponentBase
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime
@using Alis4Ops2024.Core
@using Alis4Ops2024.Models
@using Alis4Ops2024.Components.Layout

<link href="/fontawesome/css/rangemenu.css" rel="stylesheet" />

<div class="dropdown">
    <div class="row">
@*         <div class="col-3 text-align: center;" style="align-content:center;">
            <!-- Adjusted to take half width and center align -->
            <h6>Select Range</h6>
        </div> *@
        <div class="col-7">
            <button class="dropbtn" @onclick="ToggleDropdown">Multiply</button>
            <div class="dropdown-content" style="@dropdownStyle">
                @foreach (var item in MenuItems)
                {
                    <a @onclick="(() => { HandleClickedItem(item); ToggleDropdown(); })">@item.Text</a> <!-- Toggle dropdown when item clicked -->
                }
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div>ClickedItem: @SelectedMenuItem?.Text LowerRange:@LowerRange UpperRange:@UpperRange Operator:@Operator</div>
</div>

@code {

    protected override void OnInitialized()
    {
        SelectedMenuItem = MenuItems.FirstOrDefault(item => item.Text == "0");
    }

    public List<MenuItem> MenuItems { get; set; } = new List<MenuItem>
    {
        new MenuItem { Text = "0"},
        new MenuItem { Text = "1"},
        new MenuItem { Text = "2"},
        new MenuItem { Text = "3"},
        new MenuItem { Text = "4"},
        new MenuItem { Text = "5"},
        new MenuItem { Text = "6"},
        new MenuItem { Text = "7"},
        new MenuItem { Text = "8"},
        new MenuItem { Text = "9"},
        new MenuItem { Text = "10"},
        new MenuItem { Text = "11"},
        new MenuItem { Text = "12"},
        new MenuItem { Text = "Multiply-Missing"}
    };

    private string dropdownStyle => isDropdownOpen ? "display: block;" : "display: none;";

    private bool isDropdownOpen = false;
    private void ToggleDropdown()
    {
        isDropdownOpen = !isDropdownOpen;
    }

    [Parameter]
    public EventCallback<string> OperatorChanged { get; set; }
    [Parameter]
    public EventCallback<int> UpperRangeChanged { get; set; }
    [Parameter]
    public EventCallback<int> LowerRangeChanged { get; set; }
    [Parameter]
    public EventCallback<string> SelectedItemChanged { get; set; }


    private string ClickedMenuItem = "";

    private int _upperRange = 12;
    [Parameter]
    public int UpperRange
    {
        get { return _upperRange; }
        set
        {
            _upperRange = value;
        }
    }

    private int _lowerRange = 0;
    [Parameter]
    public int LowerRange
    {
        get { return _lowerRange; }
        set
        {
            _lowerRange = value;
        }
    }

    private string _operator = "Multiply";
    [Parameter]
    public string Operator
    {
        get { return _operator; }
        set
        {
            _operator = value;
        }
    }

    private string _selectedItem = "0";
    [Parameter]
    public string SelectedItem
    {
        get { return _selectedItem; }
        set
        {
            _selectedItem = value;
        }
    }


    public MenuItem SelectedMenuItem { get; set; } = null;

    void HandleClickedItem(MenuItem clickedItem)
    {
        SelectedMenuItem = clickedItem;

        Operator = "Multiply";
        SelectedItem = SelectedMenuItem.Text;
        if (SelectedItem != null) 
        {
            if (int.TryParse(SelectedItem, out int parsedUpperRangeMultiply))
              {
               // Conversion successful, use the 'number' variable
               LowerRange = parsedUpperRangeMultiply;
               UpperRange = 12;
              }
            else
              {
                // Conversion failed "Multiply-Missing"
               LowerRange = 1;
               parsedUpperRangeMultiply = 12;
              }
        }
        // Call the asynchronous method here
        _ = HandleParametersChangedAsync();

    }


    string GetItemClass(MenuItem item)
    {
        return item == SelectedMenuItem ? "selected" : "";
    }

    public class MenuItem
    {
        public string Text { get; set; }
    }



    [Parameter]
    public EventCallback ParametersChanged { get; set; }

    async Task HandleParametersChangedAsync()
    {
        await UpperRangeChanged.InvokeAsync(UpperRange);
        await LowerRangeChanged.InvokeAsync(LowerRange);
        await OperatorChanged.InvokeAsync(Operator);
        await SelectedItemChanged.InvokeAsync(SelectedItem);
        await ParametersChanged.InvokeAsync();
    }


}

